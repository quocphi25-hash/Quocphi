<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Enjoy Coffee - Order Menu</title>
<style>
body {
  font-family: "Be Vietnam Pro", sans-serif;
  background-color: #e8f5e9;
  color: #333;
  margin: 0;
  padding: 0;
}
header {
  background-color: #2e7d32;
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 22px;
  font-weight: bold;
  letter-spacing: 1px;
}
.container {
  max-width: 800px;
  margin: 20px auto;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
h2 {
  color: #1b5e20;
  border-bottom: 2px solid #81c784;
  padding-bottom: 6px;
}
.menu-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}
.menu-item select {
  margin-left: 5px;
}
button {
  background-color: #43a047;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  margin: 2px;
}
button:hover {
  background-color: #2e7d32;
}
#order-table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
}
#order-table th, #order-table td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}
#order-table th {
  background-color: #a5d6a7;
}
.total {
  text-align: right;
  margin-top: 10px;
  font-weight: bold;
  font-size: 18px;
}
.bill {
  background-color: #f1f8e9;
  padding: 10px;
  margin-top: 20px;
  border-radius: 8px;
  white-space: pre-line;
  font-family: monospace;
}
.history {
  background-color: #e0f2f1;
  padding: 10px;
  border-radius: 8px;
  margin-top: 15px;
  max-height: 400px;
  overflow-y: auto;
}
.delete-btn {
  background-color: #ef5350;
  padding: 4px 10px;
}
.delete-btn:hover {
  background-color: #d32f2f;
}
.export-btn {
  background-color: #1976d2;
  margin-top: 10px;
}
.export-btn:hover {
  background-color: #1565c0;
}
.stats-btn {
  background-color: #7b1fa2;
  margin-top: 10px;
}
.stats-btn:hover {
  background-color: #6a1b9a;
}
.history-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.history-item {
  margin-bottom: 15px;
  padding: 10px;
  border: 1px solid #81c784;
  border-radius: 8px;
  background-color: white;
}
.history-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  padding: 5px;
}
.history-content {
  margin-top: 10px;
  padding: 10px;
  background-color: #f9f9f9;
  border-radius: 5px;
  white-space: pre-line;
  font-family: monospace;
}
.stats-section {
  background-color: #fff3e0;
  padding: 15px;
  border-radius: 8px;
  margin-top: 20px;
}
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 15px;
}
.stat-card {
  background: white;
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #2e7d32;
}
.stat-label {
  font-size: 14px;
  color: #666;
  margin-top: 5px;
}
.price-info {
  font-size: 12px;
  color: #666;
  margin-top: 3px;
}
.menu-item-content {
  display: flex;
  flex-direction: column;
}
</style>
</head>
<body>
<header>â˜• ENJOY COFFEE - MENU ORDER ğŸ’š</header>
<div class="container">
  <!-- BEST SELLER SECTION -->
  <h2>ğŸ”¥ Best Seller</h2>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Sá»¯a tÆ°Æ¡i cÃ  phÃª Ly lá»›n</div>
      <div class="price-info">22.000Ä‘</div>
    </div>
    <button onclick="addItem('Sá»¯a tÆ°Æ¡i cÃ  phÃª Ly lá»›n', 22000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>CÃ  phÃª muá»‘i</div>
      <div class="price-info">S: 18.000Ä‘ | L: 25.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="S">S</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('CÃ  phÃª muá»‘i', 18000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Matcha Latte</div>
      <div class="price-info">25.000Ä‘</div>
    </div>
    <button onclick="addItem('Matcha Latte', 25000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  sá»¯a truyá»n thá»‘ng</div>
      <div class="price-info">20.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  sá»¯a truyá»n thá»‘ng', 20000)">ThÃªm</button>
  </div>

  <!-- CÃ€ PHÃŠ SECTION -->
  <h2>â˜• CÃ  PhÃª</h2>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>CÃ  phÃª Ä‘Ã¡</div>
      <div class="price-info">M: 14.000Ä‘ | L: 18.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('CÃ  phÃª Ä‘Ã¡', 14000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>CÃ  phÃª sá»¯a</div>
      <div class="price-info">M: 16.000Ä‘ | L: 20.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('CÃ  phÃª sá»¯a', 16000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>CÃ  phÃª muá»‘i</div>
      <div class="price-info">M: 18.000Ä‘ | L: 24.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('CÃ  phÃª muá»‘i', 18000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Báº¡c xá»‰u</div>
      <div class="price-info">M: 18.000Ä‘ | L: 22.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('Báº¡c xá»‰u', 18000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Báº¡c xá»‰u muá»‘i</div>
      <div class="price-info">M: 22.000Ä‘ | L: 26.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('Báº¡c xá»‰u muá»‘i', 22000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Cacao sá»¯a</div>
      <div class="price-info">M: 17.000Ä‘ | L: 22.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('Cacao sá»¯a', 17000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Cacao muá»‘i</div>
      <div class="price-info">M: 20.000Ä‘ | L: 25.000Ä‘</div>
    </div>
    <div>
      <select class="size">
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
      <button onclick="addItem('Cacao muá»‘i', 20000, this)">ThÃªm</button>
    </div>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Milo dáº§m trÃ¢n chÃ¢u tráº¯ng</div>
      <div class="price-info">17.000Ä‘</div>
    </div>
    <button onclick="addItem('Milo dáº§m trÃ¢n chÃ¢u tráº¯ng', 17000)">ThÃªm</button>
  </div>

  <!-- TRÃ€ GIáº¢I KHÃT SECTION -->
  <h2>ğŸµ TrÃ  Giáº£i KhÃ¡t</h2>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  Ä‘Ã o</div>
      <div class="price-info">20.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  Ä‘Ã o', 20000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  dÃ¢u</div>
      <div class="price-info">20.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  dÃ¢u', 20000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  váº£i</div>
      <div class="price-info">20.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  váº£i', 20000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  á»•i</div>
      <div class="price-info">20.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  á»•i', 20000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Chanh Ä‘Ã¡</div>
      <div class="price-info">15.000Ä‘</div>
    </div>
    <button onclick="addItem('Chanh Ä‘Ã¡', 15000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Lipton chanh</div>
      <div class="price-info">15.000Ä‘</div>
    </div>
    <button onclick="addItem('Lipton chanh', 15000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>Lipton chanh máº­t ong</div>
      <div class="price-info">20.000Ä‘</div>
    </div>
    <button onclick="addItem('Lipton chanh máº­t ong', 20000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  táº¯c</div>
      <div class="price-info">12.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  táº¯c', 12000)">ThÃªm</button>
  </div>
  <div class="menu-item">
    <div class="menu-item-content">
      <div>TrÃ  táº¯c xÃ­ muá»™i</div>
      <div class="price-info">15.000Ä‘</div>
    </div>
    <button onclick="addItem('TrÃ  táº¯c xÃ­ muá»™i', 15000)">ThÃªm</button>
  </div>

  <h2>Danh sÃ¡ch Order</h2>
  <table id="order-table">
    <thead><tr><th>MÃ³n</th><th>Size</th><th>GiÃ¡</th><th>XÃ³a</th></tr></thead>
    <tbody id="order-body"></tbody>
  </table>
  <div class="total">Tá»•ng: <span id="total">0</span>Ä‘</div>
  <button onclick="printBill()">Xuáº¥t Bill</button>

  <div class="bill" id="bill-output"></div>

  <!-- Pháº§n thá»‘ng kÃª theo ngÃ y -->
  <div class="stats-section">
    <h2>ğŸ“Š Thá»‘ng kÃª hÃ´m nay</h2>
    <button class="stats-btn" onclick="showDailyStats()">Xem thá»‘ng kÃª hÃ´m nay</button>
    <div id="daily-stats" class="stats-grid"></div>
  </div>

  <h2>Lá»‹ch sá»­ hÃ³a Ä‘Æ¡n (Cáº­p nháº­t theo thá»i gian thá»±c)</h2>
  <div class="history-controls">
    <button class="export-btn" onclick="exportToExcel()">Xuáº¥t Excel Lá»‹ch sá»­</button>
  </div>
  <div class="history" id="history"></div>
</div>

<script>
let orders = [];

function addItem(name, basePrice, el){
  let price = basePrice;
  let size = "";
  
  // Kiá»ƒm tra náº¿u cÃ³ dropdown size
  if (el) {
    const sizeSelect = el.parentElement.querySelector(".size");
    if (sizeSelect) {
      size = sizeSelect.value;
      // TÃ­nh giÃ¡ dá»±a trÃªn size Ä‘Æ°á»£c chá»n
      if (size === "L") {
        // TÃ­nh toÃ¡n giÃ¡ cho size L dá»±a trÃªn giÃ¡ base (M)
        switch(name) {
          case "CÃ  phÃª muá»‘i":
            price = 25000;
            break;
          case "CÃ  phÃª Ä‘Ã¡":
            price = 18000;
            break;
          case "CÃ  phÃª sá»¯a":
            price = 20000;
            break;
          case "Báº¡c xá»‰u":
            price = 22000;
            break;
          case "Báº¡c xá»‰u muá»‘i":
            price = 26000;
            break;
          case "Cacao sá»¯a":
            price = 22000;
            break;
          case "Cacao muá»‘i":
            price = 25000;
            break;
          default:
            price = basePrice;
        }
      }
    }
  }
  
  orders.push({name, size, price});
  renderOrders();
}

function renderOrders(){
  const tbody = document.getElementById("order-body");
  tbody.innerHTML = "";
  orders.forEach((item, index)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.name}</td><td>${item.size||"-"}</td><td>${item.price.toLocaleString()}Ä‘</td>
                    <td><button class="delete-btn" onclick="removeItem(${index})">X</button></td>`;
    tbody.appendChild(tr);
  });
  const total = orders.reduce((a,b)=>a+b.price,0);
  document.getElementById("total").innerText = total.toLocaleString();
}

function removeItem(i){
  orders.splice(i,1);
  renderOrders();
}

function printBill(){
  if(orders.length===0){ 
    alert("ChÆ°a cÃ³ mÃ³n nÃ o!"); 
    return; 
  }
  
  if(!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xuáº¥t bill vÃ  xÃ³a cÃ¡c mÃ³n Ä‘Ã£ Ä‘áº·t?")) {
    return;
  }
  
  const now = new Date();
  const dateStr = now.toLocaleString("vi-VN");
  let total = orders.reduce((a,b)=>a+b.price,0);
  let bill = `====================\n     ENJOY COFFEE â˜•\n====================\n${dateStr}\n\n`;
  orders.forEach((o,i)=> bill += `${i+1}. ${o.name} ${o.size||""} - ${o.price.toLocaleString()}Ä‘\n`);
  bill += `--------------------\nTá»•ng cá»™ng: ${total.toLocaleString()}Ä‘\nâ¤ï¸ Cáº£m Æ¡n quÃ½ khÃ¡ch! â¤ï¸`;
  document.getElementById("bill-output").innerText = bill;
  
  // Táº¡o báº£n sao cá»§a orders trÆ°á»›c khi xÃ³a
  const currentOrders = [...orders];
  saveBill(bill, total, currentOrders);
  
  // XÃ³a danh sÃ¡ch Ä‘áº·t hÃ ng
  orders = [];
  renderOrders();
}

function saveBill(bill, total, currentOrders){
  const now = new Date();
  const billData = {
    billText: bill,
    date: now.toLocaleString("vi-VN"),
    items: currentOrders,
    total: total,
    timestamp: now.getTime()
  };
  
  const list = JSON.parse(localStorage.getItem("bills") || "[]");
  list.push(billData);
  localStorage.setItem("bills", JSON.stringify(list));
  
  // Cáº­p nháº­t lá»‹ch sá»­ ngay láº­p tá»©c
  loadHistory();
}

function loadHistory(){
  const div = document.getElementById("history");
  const list = JSON.parse(localStorage.getItem("bills") || "[]");
  
  // Sáº¯p xáº¿p theo thá»i gian má»›i nháº¥t trÆ°á»›c
  list.sort((a, b) => b.timestamp - a.timestamp);
  
  if (list.length === 0) {
    div.innerHTML = "<p>ChÆ°a cÃ³ hÃ³a Ä‘Æ¡n nÃ o.</p>";
    return;
  }
  
  div.innerHTML = list.map((b, index) => {
    const totalFormatted = b.total.toLocaleString() + 'Ä‘';
    return `
    <div class="history-item">
      <div class="history-header" onclick="toggleBillDetails(${index})">
        <span><strong>HÃ³a Ä‘Æ¡n ${list.length - index}</strong> - ${b.date} - Tá»•ng: ${totalFormatted}</span>
        <button class="toggle-btn">Xem</button>
      </div>
      <div id="bill-details-${index}" class="history-content" style="display: none;">
        <pre>${b.billText}</pre>
        <button class="delete-btn" onclick="deleteBill(${index})">XÃ³a hÃ³a Ä‘Æ¡n nÃ y</button>
      </div>
    </div>`;
  }).join("");
}

function toggleBillDetails(index) {
  const details = document.getElementById(`bill-details-${index}`);
  if (details.style.display === 'block') {
    details.style.display = 'none';
  } else {
    details.style.display = 'block';
  }
}

function deleteBill(index) {
  if (!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a hÃ³a Ä‘Æ¡n nÃ y?")) {
    return;
  }
  const list = JSON.parse(localStorage.getItem("bills") || "[]");
  list.splice(index, 1);
  localStorage.setItem("bills", JSON.stringify(list));
  loadHistory();
}

function exportToExcel() {
  const list = JSON.parse(localStorage.getItem("bills") || "[]");
  if (list.length === 0) {
    alert("KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t!");
    return;
  }
  
  // Táº¡o dá»¯ liá»‡u CSV
  let csvContent = "STT,NgÃ y,TÃªn mÃ³n,Size,GiÃ¡\n";
  
  let stt = 1;
  list.forEach(bill => {
    bill.items.forEach(item => {
      csvContent += `${stt},"${bill.date}","${item.name}","${item.size || ''}","${item.price}"\n`;
      stt++;
    });
  });
  
  // Táº¡o file vÃ  táº£i vá»
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement("a");
  const url = URL.createObjectURL(blob);
  link.setAttribute("href", url);
  link.setAttribute("download", `lich_su_ban_hang_${new Date().toLocaleDateString('vi-VN')}.csv`);
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Thá»‘ng kÃª theo ngÃ y
function showDailyStats() {
  const list = JSON.parse(localStorage.getItem("bills") || "[]");
  const today = new Date();
  const todayString = today.toLocaleDateString('vi-VN');
  
  // Lá»c hÃ³a Ä‘Æ¡n trong ngÃ y hÃ´m nay
  const todayBills = list.filter(bill => {
    const billDate = new Date(bill.timestamp).toLocaleDateString('vi-VN');
    return billDate === todayString;
  });
  
  if (todayBills.length === 0) {
    document.getElementById('daily-stats').innerHTML = '<p>HÃ´m nay chÆ°a cÃ³ hÃ³a Ä‘Æ¡n nÃ o.</p>';
    return;
  }
  
  // TÃ­nh toÃ¡n thá»‘ng kÃª
  let totalRevenue = 0;
  let totalOrders = todayBills.length;
  let productCount = {};
  let totalItems = 0;
  
  todayBills.forEach(bill => {
    totalRevenue += bill.total;
    bill.items.forEach(item => {
      totalItems++;
      const key = item.name + (item.size ? ` (${item.size})` : '');
      productCount[key] = (productCount[key] || 0) + 1;
    });
  });
  
  // TÃ¬m sáº£n pháº©m bÃ¡n cháº¡y nháº¥t
  let bestSeller = { name: '', count: 0 };
  Object.entries(productCount).forEach(([product, count]) => {
    if (count > bestSeller.count) {
      bestSeller = { name: product, count: count };
    }
  });
  
  // Hiá»ƒn thá»‹ thá»‘ng kÃª
  const statsContainer = document.getElementById('daily-stats');
  statsContainer.innerHTML = `
    <div class="stat-card">
      <div class="stat-value">${totalOrders}</div>
      <div class="stat-label">HÃ³a Ä‘Æ¡n</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${totalRevenue.toLocaleString()}Ä‘</div>
      <div class="stat-label">Doanh thu</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${totalItems}</div>
      <div class="stat-label">Sá»‘ mÃ³n Ä‘Ã£ bÃ¡n</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${bestSeller.count}</div>
      <div class="stat-label">${bestSeller.name || 'ChÆ°a cÃ³'}</div>
    </div>
  `;
  
  // ThÃªm chi tiáº¿t sáº£n pháº©m bÃ¡n cháº¡y
  let productDetails = '<div style="grid-column: 1 / -1; margin-top: 15px;"><h3>Chi tiáº¿t sáº£n pháº©m bÃ¡n cháº¡y:</h3><ul>';
  Object.entries(productCount)
    .sort((a, b) => b[1] - a[1])
    .forEach(([product, count]) => {
      productDetails += `<li>${product}: ${count} lÆ°á»£t</li>`;
    });
  productDetails += '</ul></div>';
  
  statsContainer.innerHTML += productDetails;
}

// Táº£i lá»‹ch sá»­ khi trang Ä‘Æ°á»£c má»Ÿ
loadHistory();

// ThÃªm sá»± kiá»‡n láº¯ng nghe thay Ä‘á»•i localStorage Ä‘á»ƒ cáº­p nháº­t thá»i gian thá»±c
window.addEventListener('storage', function(e) {
  if (e.key === 'bills') {
    loadHistory();
  }
});
</script>
</body>
</html>
